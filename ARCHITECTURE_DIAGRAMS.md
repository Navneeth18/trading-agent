# Trading Agents - Architecture Diagrams

## System Architecture Overview

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                        TRADING AGENTS SYSTEM                              ║
║                     (AI-Powered Stock Analysis)                           ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────┐
│                          EXTERNAL SERVICES                                │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐             │
│  │  Finnhub    │      │  yfinance   │      │ PostgreSQL  │             │
│  │   API       │      │  (Yahoo)    │      │  Database   │             │
│  │             │      │             │      │             │             │
│  │ • Quotes    │      │ • News      │      │ • Quotes    │             │
│  │ • Real-time │      │ • History   │      │ • Sentiment │             │
│  │ • REST API  │      │ • Free      │      │ • Trades    │             │
│  └──────┬──────┘      └──────┬──────┘      └──────┬──────┘             │
│         │                    │                    │                      │
└─────────┼────────────────────┼────────────────────┼───────────────────────┘
          │                    │                    │
          └────────────┬───────┴────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────────────────────────────────┐
│                        APPLICATION LAYER                                  │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                      MAIN.PY (Entry Point)                          │ │
│  │  • Load configuration (.env)                                        │ │
│  │  • Parse CLI arguments                                              │ │
│  │  • Initialize workflow                                              │ │
│  │  • Handle monitoring mode                                           │ │
│  └────────────────────────────┬────────────────────────────────────────┘ │
│                               │                                           │
│                               ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                   TRADING WORKFLOW (LangGraph)                      │ │
│  │                                                                     │ │
│  │  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐          │ │
│  │  │   Node 1:    │──▶│   Node 2:    │──▶│   Node 3:    │          │ │
│  │  │     Data     │   │  Sentiment   │   │  Technical   │          │ │
│  │  │  Ingestion   │   │   Analysis   │   │   Analysis   │          │ │
│  │  └──────────────┘   └──────────────┘   └──────────────┘          │ │
│  │         │                   │                   │                  │ │
│  │         └───────────────────┴───────────────────┘                  │ │
│  │                             │                                       │ │
│  │                             ▼                                       │ │
│  │                    ┌──────────────┐                                │ │
│  │                    │   Node 4:    │                                │ │
│  │                    │  Portfolio   │                                │ │
│  │                    │   Manager    │                                │ │
│  │                    └──────────────┘                                │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                               │                                           │
│                               ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                    RICH DASHBOARD (CLI)                             │ │
│  │  • Summary table                                                    │ │
│  │  • Detailed panels                                                  │ │
│  │  • Color-coded output                                               │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│                          AI MODELS LAYER                                  │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐          │
│  │   FinBERT    │      │  Llama 3.2   │      │ DeepSeek-R1  │          │
│  │   (Local)    │      │   (Ollama)   │      │   (Ollama)   │          │
│  │              │      │              │      │              │          │
│  │ • CPU        │      │ • 3B params  │      │ • 7B params  │          │
│  │ • 110M params│      │ • Technical  │      │ • Reasoning  │          │
│  │ • Sentiment  │      │ • Fast       │      │ • CoT        │          │
│  └──────────────┘      └──────────────┘      └──────────────┘          │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

---

## Detailed Workflow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    LANGGRAPH WORKFLOW EXECUTION                         │
└─────────────────────────────────────────────────────────────────────────┘

INPUT: ticker = "NVDA"
  │
  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ NODE 1: DATA INGESTION                                                  │
│ ─────────────────────────────────────────────────────────────────────── │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────┐   │
│ │ FinnhubClient.get_quote("NVDA")                                 │   │
│ │ ↓                                                                │   │
│ │ HTTP GET: https://finnhub.io/api/v1/quote?symbol=NVDA          │   │
│ │ ↓                                                                │   │
│ │ Response: {                                                      │   │
│ │   "c": 184.89,  // current price                                │   │
│ │   "d": -10.67,  // change                                       │   │
│ │   "dp": -5.46,  // percent change                               │   │
│ │   "h": 195.56,  // high                                         │   │
│ │   "l": 183.00,  // low                                          │   │
│ │   "o": 195.00,  // open                                         │   │
│ │   "pc": 195.56  // previous close                               │   │
│ │ }                                                                │   │
│ │ ↓                                                                │   │
│ │ db.insert_market_quote(ticker, data)                            │   │
│ └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────┐   │
│ │ YFinanceClient.get_news("NVDA", limit=10)                       │   │
│ │ ↓                                                                │   │
│ │ stock = yf.Ticker("NVDA")                                       │   │
│ │ news = stock.news                                               │   │
│ │ ↓                                                                │   │
│ │ headlines = [                                                    │   │
│ │   "NVIDIA announces new AI chip...",                            │   │
│ │   "NVDA stock drops on earnings miss...",                       │   │
│ │   "Analysts upgrade NVIDIA target...",                          │   │
│ │   ...                                                            │   │
│ │ ]                                                                │   │
│ └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────┐   │
│ │ YFinanceClient.get_price_history("NVDA", period="1mo")         │   │
│ │ ↓                                                                │   │
│ │ DataFrame (30 days):                                             │   │
│ │ Date       | Open   | High   | Low    | Close  | Volume        │   │
│ │ 2026-01-27 | 195.00 | 195.56 | 183.00 | 184.89 | 45M           │   │
│ │ 2026-01-26 | 198.00 | 200.00 | 195.00 | 195.56 | 38M           │   │
│ │ ...                                                              │   │
│ └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│ OUTPUT STATE:                                                           │
│ ├─ market_data: Dict                                                    │
│ ├─ headlines: List[str]                                                 │
│ └─ price_history: DataFrame                                             │
└─────────────────────────────────────────────────────────────────────────┘
  │
  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ NODE 2: SENTIMENT ANALYSIS                                              │
│ ─────────────────────────────────────────────────────────────────────── │
│                                                                         │
│ INPUT: headlines = ["NVIDIA announces...", "NVDA stock drops...", ...] │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────┐   │
│ │ SentimentAnalyst.analyze_news(ticker, headlines)                │   │
│ │                                                                  │   │
│ │ FOR EACH headline:                                               │   │
│ │   ┌──────────────────────────────────────────────────────────┐  │   │
│ │   │ 1. TOKENIZATION                                          │  │   │
│ │   │    inputs = tokenizer(                                   │  │   │
│ │   │        headline,                                         │  │   │
│ │   │        return_tensors="pt",                              │  │   │
│ │   │        truncation=True,                                  │  │   │
│ │   │        max_length=512,                                   │  │   │
│ │   │        padding=True                                      │  │   │
│ │   │    )                                                      │  │   │
│ │   │    ↓                                                      │  │   │
│ │   │    Tensor: [101, 2358, 7295, ..., 102]                  │  │   │
│ │   │           [CLS] NVIDIA announces ... [SEP]               │  │   │
│ │   └──────────────────────────────────────────────────────────┘  │   │
│ │   ┌──────────────────────────────────────────────────────────┐  │   │
│ │   │ 2. FINBERT INFERENCE (CPU)                               │  │   │
│ │   │    with torch.no_grad():                                 │  │   │
│ │   │        outputs = model(**inputs)                         │  │   │
│ │   │        logits = outputs.logits                           │  │   │
│ │   │        probs = softmax(logits, dim=-1)                   │  │   │
│ │   │    ↓                                                      │  │   │
│ │   │    Probabilities:                                        │  │   │
│ │   │    [0.05, 0.15, 0.80]                                    │  │   │
│ │   │     neg   neu   pos                                      │  │   │
│ │   └──────────────────────────────────────────────────────────┘  │   │
│ │   ┌──────────────────────────────────────────────────────────┐  │   │
│ │   │ 3. CLASSIFICATION                                        │  │   │
│ │   │    sentiment = argmax(probs) = 'positive'                │  │   │
│ │   │    confidence = max(probs) = 0.80                        │  │   │
│ │   └──────────────────────────────────────────────────────────┘  │   │
│ │   ┌──────────────────────────────────────────────────────────┐  │   │
│ │   │ 4. STORE IN DATABASE                                     │  │   │
│ │   │    INSERT INTO sentiment_scores (                        │  │   │
│ │   │        ticker, headline, sentiment, score, timestamp     │  │   │
│ │   │    ) VALUES (                                            │  │   │
│ │   │        'NVDA', 'NVIDIA announces...', 'positive', 0.80   │  │   │
│ │   │    )                                                      │  │   │
│ │   └──────────────────────────────────────────────────────────┘  │   │
│ │                                                                  │   │
│ │ AGGREGATION:                                                     │   │
│ │   results = [                                                    │   │
│ │     {'sentiment': 'positive', 'confidence': 0.80},              │   │
│ │     {'sentiment': 'negative', 'confidence': 0.75},              │   │
│ │     {'sentiment': 'positive', 'confidence': 0.70},              │   │
│ │     {'sentiment': 'neutral', 'confidence': 0.65},               │   │
│ │     ...                                                          │   │
│ │   ]                                                              │   │
│ │   ↓                                                              │   │
│ │   positive_count = 6                                             │   │
│ │   negative_count = 2                                             │   │
│ │   neutral_count = 2                                              │   │
│ │   total = 10                                                     │   │
│ │   ↓                                                              │   │
│ │   sentiment_score = (6 - 2) / 10 = 0.40                         │   │
│ │   ↓                                                              │   │
│ │   if score > 0.2: avg_sentiment = 'positive'                    │   │
│ └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│ OUTPUT STATE:                                                           │
│ sentiment_data = {                                                      │
│     'ticker': 'NVDA',                                                   │
│     'avg_sentiment': 'positive',                                        │
│     'avg_score': 0.40,                                                  │
│     'positive_ratio': 0.60,                                             │
│     'negative_ratio': 0.20,                                             │
│     'neutral_ratio': 0.20,                                              │
│     'total_headlines': 10                                               │
│ }                                                                       │
└─────────────────────────────────────────────────────────────────────────┘
  │
  ▼
